---
title: difference-between-two
author: gglee
date: '2020-04-19'
categories:
  - Statistics
tags:
  - simulation
slug: difference-between-two
draft: yes
---



<p>두 표본의 통계량 차이를 반복실험을 통해서 알아보자. 일반적으로 잘알려진 사실은 두 표본의 평균의 차는 변하지 않는다. 다만, 편차, 신뢰구간, 또는 표준오차는 몇개를 뽑느냐, 모분산이 있느냐 없느냐에 따라 여러 계산식으로 표현될 수 있다. 하지만, 간단하게 반복실험을 해보면 쉽게 결과를 확인할 수 있다.</p>
<p>정규분포를 가지는 두 집단에서의 차이를 계산하는 함수이다.</p>
<pre class="r"><code>simulation_diff &lt;- function(n1, m1, s1, n2, m2, s2, n_total = 100000) {
  m &lt;-list()
  for (i in 1:n_total) {
    x1 &lt;- rnorm(n1, m1, s1)
    x2 &lt;- rnorm(n2, m2, s2)
    x1_m &lt;- mean(x1)
    x2_m &lt;- mean(x2)
    m[[i]] &lt;- x2_m - x1_m
  }
  unlist(m)
}</code></pre>
<div id="한번만-측정시" class="section level2">
<h2>한번만 측정시</h2>
<pre class="r"><code>sim1 &lt;- simulation_diff(n1 = 1, m1 = 10, s1 = 1, n2 = 1, m2 = 11, s2 = 1)
mean(sim1)  # = 11 - 10 </code></pre>
<pre><code>## [1] 1.007093</code></pre>
<pre class="r"><code>var(sim1)   # = 1^2 + 1^2</code></pre>
<pre><code>## [1] 1.995462</code></pre>
<pre class="r"><code>sd(sim1)    # sqrt(var(sim1)</code></pre>
<pre><code>## [1] 1.412608</code></pre>
</div>
<div id="각각-2번씩-측정할-경우" class="section level2">
<h2>각각 2번씩 측정할 경우</h2>
<pre class="r"><code>sim2 &lt;- simulation_diff(n1 = 2, m1 = 10, s1 = 1, n2 = 2, m2 = 11, s2 = 1)
mean(sim2)  # = 11 - 10 </code></pre>
<pre><code>## [1] 0.9988947</code></pre>
<pre class="r"><code>var(sim2)   # = 1^2 / 2 + 1^2 / 2</code></pre>
<pre><code>## [1] 0.9935704</code></pre>
</div>
<div id="두-표본의-sd가-다른-경우" class="section level2">
<h2>두 표본의 sd가 다른 경우</h2>
<pre class="r"><code>sim3 &lt;- simulation_diff(n1 = 2, m1 = 10, s1 = 2, n2 = 2, m2 = 11, s2 = 1)
mean(sim3)  # = 11 - 10 </code></pre>
<pre><code>## [1] 0.9974182</code></pre>
<pre class="r"><code>var(sim3)   # = 2^2 / 2 + 1^2 / 2</code></pre>
<pre><code>## [1] 2.503727</code></pre>
<p>보다시피 어떤 경우에도 잘 대응된다. 즉 일반적으로,</p>
<p><span class="math display">\[ var(x_2 - x_1) = \frac{var(x_1)}{N_1} + \frac{var(x_2)}{N_2}  \]</span>
<span class="math display">\[ sd(x_2 - x_1) = \sqrt{ \frac{sd(x_1)^2}{N_1} + \frac{sd(x_2)^2}{N_2}  } \]</span></p>
</div>
<div id="실전-적용" class="section level2">
<h2>실전 적용</h2>
<p>철판 두께 측정으로 다시 생각해보자.</p>
<pre class="r"><code>rnorm_simulation &lt;- function(inspection, 
                             mu, 
                             sigma, 
                             n_sample, 
                             n_test = 10000, 
                             seed = NULL) {
  if (!is.null(seed)) set.seed(seed)
  m_list &lt;- vector(&quot;double&quot;, n_test)
  s_list &lt;- vector(&quot;double&quot;, n_test)
  v_list &lt;- vector(&quot;double&quot;, n_test)
  for (i in 1:n_test) {
    a_sample &lt;- rnorm(n_sample, mean = mu, sd = sigma)
    m_list[[i]] &lt;- mean(a_sample)
    s_list[[i]] &lt;- sd(a_sample)
    v_list[[i]] &lt;- var(a_sample)
  }
  tibble(
    inspection = inspection,
    grid = 1:n_test,
    n_sample = n_sample, 
    sample_mean = m_list, 
    sample_sd = s_list, 
    sample_var = v_list)  
}</code></pre>
<pre class="r"><code>df1 &lt;- rnorm_simulation(
  inspection = &quot;1st&quot;, mu = 10, sigma = 1, n_sample = 4, seed = 21
) %&gt;% rename_all(~str_c(., &#39;_1&#39;))
df1</code></pre>
<pre><code>## # A tibble: 10,000 x 6
##    inspection_1 grid_1 n_sample_1 sample_mean_1 sample_sd_1 sample_var_1
##    &lt;chr&gt;         &lt;int&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 1st               1          4         10.4        1.26         1.59 
##  2 1st               2          4         10.0        1.67         2.78 
##  3 1st               3          4          9.64       1.32         1.74 
##  4 1st               4          4         10.4        0.859        0.737
##  5 1st               5          4         10.1        0.896        0.803
##  6 1st               6          4          9.53       0.806        0.650
##  7 1st               7          4          9.93       0.809        0.654
##  8 1st               8          4          9.08       0.627        0.394
##  9 1st               9          4         10.7        0.769        0.591
## 10 1st              10          4         11.2        0.772        0.596
## # … with 9,990 more rows</code></pre>
<pre class="r"><code>df2 &lt;- rnorm_simulation(
  inspection = &quot;2nd&quot;, mu = 9, sigma = 1, n_sample = 4, seed = 23
) %&gt;% rename_all(~str_c(., &#39;_2&#39;))
df2</code></pre>
<pre><code>## # A tibble: 10,000 x 6
##    inspection_2 grid_2 n_sample_2 sample_mean_2 sample_sd_2 sample_var_2
##    &lt;chr&gt;         &lt;int&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 2nd               1          4          9.62       0.959        0.919
##  2 2nd               2          4          9.71       0.661        0.437
##  3 2nd               3          4          9.20       1.08         1.16 
##  4 2nd               4          4          8.82       0.766        0.587
##  5 2nd               5          4          8.93       0.910        0.828
##  6 2nd               6          4          8.97       0.999        0.999
##  7 2nd               7          4          9.05       0.833        0.693
##  8 2nd               8          4          8.76       0.430        0.185
##  9 2nd               9          4          8.39       0.703        0.495
## 10 2nd              10          4          9.26       1.16         1.34 
## # … with 9,990 more rows</code></pre>
<pre class="r"><code>dd &lt;- 
  bind_cols(df1, df2)
dd</code></pre>
<pre><code>## # A tibble: 10,000 x 12
##    inspection_1 grid_1 n_sample_1 sample_mean_1 sample_sd_1 sample_var_1
##    &lt;chr&gt;         &lt;int&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 1st               1          4         10.4        1.26         1.59 
##  2 1st               2          4         10.0        1.67         2.78 
##  3 1st               3          4          9.64       1.32         1.74 
##  4 1st               4          4         10.4        0.859        0.737
##  5 1st               5          4         10.1        0.896        0.803
##  6 1st               6          4          9.53       0.806        0.650
##  7 1st               7          4          9.93       0.809        0.654
##  8 1st               8          4          9.08       0.627        0.394
##  9 1st               9          4         10.7        0.769        0.591
## 10 1st              10          4         11.2        0.772        0.596
## # … with 9,990 more rows, and 6 more variables: inspection_2 &lt;chr&gt;,
## #   grid_2 &lt;int&gt;, n_sample_2 &lt;dbl&gt;, sample_mean_2 &lt;dbl&gt;, sample_sd_2 &lt;dbl&gt;,
## #   sample_var_2 &lt;dbl&gt;</code></pre>
<pre class="r"><code>dd &lt;- dd %&gt;% 
  mutate(
    diff_mean = sample_mean_2 - sample_mean_1,
    diff_sd = sqrt(sample_sd_2^2 / n_sample_2 + sample_sd_1^2 / n_sample_1),
    diff_var = sample_var_2 / n_sample_2 + sample_var_1 / n_sample_1
  )
dd</code></pre>
<pre><code>## # A tibble: 10,000 x 15
##    inspection_1 grid_1 n_sample_1 sample_mean_1 sample_sd_1 sample_var_1
##    &lt;chr&gt;         &lt;int&gt;      &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1 1st               1          4         10.4        1.26         1.59 
##  2 1st               2          4         10.0        1.67         2.78 
##  3 1st               3          4          9.64       1.32         1.74 
##  4 1st               4          4         10.4        0.859        0.737
##  5 1st               5          4         10.1        0.896        0.803
##  6 1st               6          4          9.53       0.806        0.650
##  7 1st               7          4          9.93       0.809        0.654
##  8 1st               8          4          9.08       0.627        0.394
##  9 1st               9          4         10.7        0.769        0.591
## 10 1st              10          4         11.2        0.772        0.596
## # … with 9,990 more rows, and 9 more variables: inspection_2 &lt;chr&gt;,
## #   grid_2 &lt;int&gt;, n_sample_2 &lt;dbl&gt;, sample_mean_2 &lt;dbl&gt;, sample_sd_2 &lt;dbl&gt;,
## #   sample_var_2 &lt;dbl&gt;, diff_mean &lt;dbl&gt;, diff_sd &lt;dbl&gt;, diff_var &lt;dbl&gt;</code></pre>
<pre class="r"><code>dd %&gt;% summarize(
  average_diff_mean = mean(diff_mean),
  average_diff_sd = mean(diff_sd),  # caution: not sqrt(diff_var)
  average_diff_var = mean(diff_var)
)</code></pre>
<pre><code>## # A tibble: 1 x 3
##   average_diff_mean average_diff_sd average_diff_var
##               &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;
## 1             -1.01           0.680            0.503</code></pre>
<pre class="r"><code>dd %&gt;% 
  pivot_longer(
    cols = c(&quot;diff_mean&quot;, &quot;diff_var&quot;), 
    names_to = &quot;keys&quot;, values_to = &quot;values&quot;
  ) %&gt;%
  ggplot(aes(values)) +
  geom_histogram(color = &quot;black&quot;, fill = &quot;white&quot;) +
    facet_wrap(~keys, scales = &quot;free&quot;)</code></pre>
<p><img src="/post/2020-04-19-difference-between-two_files/figure-html/unnamed-chunk-13-1.png" width="672" /></p>
</div>
